<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ contest.name }} - Contest Details</title>

  <style>
    /* ===== Modern Contest Detail Design ===== */
    :root{
      --primary:#1877f2; --primary-hover:#166fe5; --primary-light:#e7f3ff;
      --secondary:#42b883; --secondary-hover:#3aa876; --secondary-light:#e8f5e8;
      --success:#42b883; --warning:#f7b731; --danger:#e74c3c; --info:#17a2b8;
      --gray:#f0f2f5; --gray-dark:#65676b; --gray-light:#f8f9fa;
      --white:#ffffff; --black:#1c1e21; --text:#1c1e21;
      --border:#dadde1; --shadow:0 2px 4px rgba(0,0,0,0.1), 0 8px 16px rgba(0,0,0,0.1);
      --radius:8px; --radius-lg:12px;
    }
    *{box-sizing:border-box; margin:0; padding:0}
    body{background:var(--gray); color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; line-height:1.4}

    /* ===== Top Navigation ===== */
    .topbar{
      background:var(--white); border-bottom:1px solid var(--border);
      position:sticky; top:0; z-index:1000; box-shadow:0 1px 2px rgba(0,0,0,0.1)
    }
    .topbar__inner{
      max-width:1200px; margin:0 auto; display:flex; align-items:center; justify-content:space-between;
      padding:8px 16px; height:56px
    }
    .brand{
      display:flex; align-items:center; gap:8px; text-decoration:none; font-weight:700; font-size:20px
    }
    .brand__logo{
      width:40px; height:40px; border-radius:50%; background:var(--primary);
      display:flex; align-items:center; justify-content:center; color:white; font-weight:800
    }
    .brand__text{color:var(--text)}

    .nav-tabs{
      display:flex; gap:8px; align-items:center; flex:1; justify-content:center
    }
    .nav-tab{
      padding:8px 16px; border-radius:var(--radius); text-decoration:none; font-weight:600;
      color:var(--gray-dark); transition:all 0.2s; position:relative
    }
    .nav-tab:hover{background:var(--gray-light); color:var(--text)}
    .nav-tab.active{color:var(--primary); background:var(--primary-light)}

    .user-menu{
      display:flex; align-items:center; gap:12px
    }
    .user-avatar{
      width:32px; height:32px; border-radius:50%; background:var(--primary);
      display:flex; align-items:center; justify-content:center; color:white; font-weight:600
    }

    /* ===== Main Content ===== */
    .main-content{
      max-width:1200px; margin:0 auto; padding:24px 16px
    }

    /* ===== Page Header ===== */
    .page-header{
      display:flex; justify-content:space-between; align-items:center; margin-bottom:24px
    }
    .page-title{
      font-size:28px; font-weight:700; color:var(--text)
    }
    .btn{
      padding:10px 20px; border-radius:var(--radius); text-decoration:none; font-weight:600;
      transition:all 0.2s; border:none; cursor:pointer; display:inline-flex; align-items:center; gap:8px
    }
    .btn-primary{
      background:var(--primary); color:white
    }
    .btn-primary:hover{background:var(--primary-hover); color:white}
    .btn-secondary{
      background:var(--secondary); color:white
    }
    .btn-secondary:hover{background:var(--secondary-hover); color:white}

    /* ===== Contest Info Card ===== */
    .contest-info{
      background:var(--white); border-radius:var(--radius-lg); padding:24px; box-shadow:var(--shadow);
      border:1px solid var(--border); margin-bottom:24px
    }
    .contest-header{
      display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:16px
    }
    .contest-title{
      font-size:24px; font-weight:700; color:var(--text); margin-bottom:8px
    }
    .contest-status{
      padding:6px 16px; border-radius:20px; font-size:14px; font-weight:600; text-transform:uppercase
    }
    .status-active{background:var(--secondary-light); color:var(--secondary)}
    .status-upcoming{background:var(--info); color:white}
    .status-ended{background:var(--gray-light); color:var(--gray-dark)}

    .contest-description{
      color:var(--gray-dark); margin-bottom:20px; line-height:1.6
    }

    .contest-stats{
      display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:16px
    }
    .stat-item{
      text-align:center; padding:16px; background:var(--gray-light); border-radius:var(--radius)
    }
    .stat-number{
      font-size:24px; font-weight:700; color:var(--text)
    }
    .stat-label{
      font-size:12px; color:var(--gray-dark); text-transform:uppercase; font-weight:600
    }

    /* ===== Entries Section ===== */
    .entries-section{
      background:var(--white); border-radius:var(--radius-lg); padding:24px; box-shadow:var(--shadow);
      border:1px solid var(--border)
    }
    .section-header{
      display:flex; justify-content:space-between; align-items:center; margin-bottom:20px
    }
    .section-title{
      font-size:20px; font-weight:700; color:var(--text)
    }

    /* ===== Filters ===== */
    .filters{
      display:flex; gap:12px; margin-bottom:20px; flex-wrap:wrap
    }
    .filter-group{
      display:flex; flex-direction:column; gap:4px
    }
    .filter-label{
      font-size:12px; font-weight:600; color:var(--gray-dark); text-transform:uppercase
    }
    .filter-select{
      padding:8px 12px; border:1px solid var(--border); border-radius:var(--radius);
      background:var(--white); font-size:14px
    }

    /* ===== Entries Table ===== */
    .entries-table{
      width:100%; border-collapse:collapse; margin-top:16px
    }
    .entries-table th{
      background:var(--gray-light); padding:12px; text-align:left; font-weight:600;
      color:var(--text); border-bottom:1px solid var(--border)
    }
    .entries-table td{
      padding:12px; border-bottom:1px solid var(--border)
    }
    .entries-table tr:hover{
      background:var(--gray-light)
    }

    .status-badge{
      padding:4px 8px; border-radius:12px; font-size:12px; font-weight:600; text-transform:uppercase
    }
    .status-pending{background:var(--warning); color:white}
    .status-submitted{background:var(--info); color:white}
    .status-verified{background:var(--success); color:white}
    .status-rejected{background:var(--danger); color:white}
    .status-winner{background:var(--primary); color:white}

    .btn-sm{
      padding:6px 12px; font-size:14px
    }

    /* ===== Pagination ===== */
    .pagination{
      display:flex; justify-content:center; align-items:center; gap:8px; margin-top:24px
    }
    .page-link{
      padding:8px 12px; border:1px solid var(--border); border-radius:var(--radius);
      text-decoration:none; color:var(--text); background:var(--white)
    }
    .page-link:hover{
      background:var(--gray-light)
    }
    .page-link.current{
      background:var(--primary); color:white; border-color:var(--primary)
    }

    /* ===== Empty State ===== */
    .empty-state{
      text-align:center; padding:60px 20px; color:var(--gray-dark)
    }
    .empty-state-icon{
      font-size:48px; margin-bottom:16px
    }
    .empty-state-title{
      font-size:20px; font-weight:700; margin-bottom:8px
    }

    /* ===== Responsive ===== */
    @media (max-width: 768px){
      .contest-stats{grid-template-columns:repeat(2, 1fr)}
      .filters{flex-direction:column}
      .entries-table{font-size:14px}
      .entries-table th, .entries-table td{padding:8px}
    }
  </style>
</head>
<body>
  <!-- Top Navigation -->
  <div class="topbar">
    <div class="topbar__inner">
      <a href="{% url 'contest_home' %}" class="brand">
        <div class="brand__logo">W</div>
        <span class="brand__text">WhatsApp Contest</span>
      </a>
      
      <div class="nav-tabs">
        <a href="{% url 'contest_home' %}" class="nav-tab active">Contest</a>
        <a href="{% url 'crm_home' %}" class="nav-tab">CRM</a>
        <a href="{% url 'manage_customers' %}" class="nav-tab">Customers</a>
      </div>
      
      <div class="user-menu">
        <div class="user-avatar">{{ user.username|first|upper }}</div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">{{ contest.name }}</h1>
      <div>
        <a href="{% url 'contest_analytics' %}?contest_id={{ contest.contest_id }}" class="btn btn-secondary">
          üìä Analytics
        </a>
        <a href="{% url 'contest_home' %}" class="btn btn-primary">
          ‚Üê Back to Contests
        </a>
      </div>
    </div>

    <!-- Contest Information -->
    <div class="contest-info">
      <div class="contest-header">
        <div>
          <h2 class="contest-title">{{ contest.name }}</h2>
          <div class="contest-status 
            {% if contest.is_currently_active %}status-active
            {% elif contest.starts_at > now %}status-upcoming
            {% else %}status-ended{% endif %}">
            {% if contest.is_currently_active %}Active
            {% elif contest.starts_at > now %}Upcoming
            {% else %}Ended{% endif %}
          </div>
        </div>
      </div>
      
      {% if contest.description %}
        <p class="contest-description">{{ contest.description }}</p>
      {% endif %}
      
      <div class="contest-stats">
        <div class="stat-item">
          <div class="stat-number">{{ contest_stats.total_entries }}</div>
          <div class="stat-label">Total Entries</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ contest_stats.verified_entries }}</div>
          <div class="stat-label">Verified</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ contest_stats.pending_entries }}</div>
          <div class="stat-label">Pending</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ contest_stats.winners }}</div>
          <div class="stat-label">Winners</div>
        </div>
      </div>
    </div>

    <!-- Entries Section -->
    <div class="entries-section">
      <div class="section-header">
        <h2 class="section-title">Contest Entries</h2>
      </div>

      <!-- Filters -->
      <div class="filters">
        <div class="filter-group">
          <label class="filter-label">Status</label>
          <select class="filter-select" onchange="filterByStatus(this.value)">
            <option value="">All Status</option>
            {% for value, label in status_choices %}
              <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="filter-group">
          <label class="filter-label">Search</label>
          <input type="text" class="filter-select" placeholder="Search by name..." 
                 value="{{ search }}" onkeyup="searchEntries(this.value)">
        </div>
      </div>

      <!-- Entries Table -->
      {% if entries %}
        <table class="entries-table">
          <thead>
            <tr>
              <th>Contestant</th>
              <th>Phone</th>
              <th>NRIC</th>
              <th>Status</th>
              <th>Submitted</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in entries %}
              <tr>
                <td>
                  <strong>{{ entry.contestant_name|default:entry.customer.name }}</strong>
                </td>
                <td>{{ entry.contestant_phone|default:entry.customer.phone_number }}</td>
                <td>{{ entry.contestant_nric|default:"Not provided" }}</td>
                <td>
                  <span class="status-badge status-{{ entry.status }}">
                    {{ entry.get_status_display }}
                  </span>
                </td>
                <td>{{ entry.submitted_at|date:"M d, Y H:i" }}</td>
                <td>
                  <a href="{% url 'contest_verify_entry' entry.entry_id %}" class="btn btn-primary btn-sm">
                    Review
                  </a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

        <!-- Pagination -->
        {% if entries.has_other_pages %}
          <div class="pagination">
            {% if entries.has_previous %}
              <a href="?page={{ entries.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if search %}&search={{ search }}{% endif %}" 
                 class="page-link">‚Üê Previous</a>
            {% endif %}
            
            {% for num in entries.paginator.page_range %}
              {% if entries.number == num %}
                <span class="page-link current">{{ num }}</span>
              {% elif num > entries.number|add:'-3' and num < entries.number|add:'3' %}
                <a href="?page={{ num }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if search %}&search={{ search }}{% endif %}" 
                   class="page-link">{{ num }}</a>
              {% endif %}
            {% endfor %}
            
            {% if entries.has_next %}
              <a href="?page={{ entries.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if search %}&search={{ search }}{% endif %}" 
                 class="page-link">Next ‚Üí</a>
            {% endif %}
          </div>
        {% endif %}
      {% else %}
        <div class="empty-state">
          <div class="empty-state-icon">üìù</div>
          <h3 class="empty-state-title">No Entries Yet</h3>
          <p>No contest entries found. Entries will appear here as customers participate.</p>
        </div>
      {% endif %}
    </div>
  </div>

  <script>
    function filterByStatus(status) {
      const url = new URL(window.location);
      if (status) {
        url.searchParams.set('status', status);
      } else {
        url.searchParams.delete('status');
      }
      window.location.href = url.toString();
    }

    function searchEntries(query) {
      const url = new URL(window.location);
      if (query) {
        url.searchParams.set('search', query);
      } else {
        url.searchParams.delete('search');
      }
      // Debounce search
      clearTimeout(window.searchTimeout);
      window.searchTimeout = setTimeout(() => {
        window.location.href = url.toString();
      }, 500);
    }
  </script>
</body>
</html>
