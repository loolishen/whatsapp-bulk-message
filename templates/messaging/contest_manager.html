<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Contest Manager - Detailed Entries</title>

  <style>
    /* ===== Google Material Design Variables ===== */
    :root{
      --primary:#1a73e8; --primary-hover:#1557b0; --primary-light:#e8f0fe;
      --secondary:#34a853; --secondary-hover:#2d8f47; --secondary-light:#e6f4ea;
      --success:#34a853; --warning:#fbbc04; --danger:#ea4335; --info:#4285f4;
      --gray:#f8f9fa; --gray-dark:#5f6368; --gray-light:#f1f3f4;
      --white:#ffffff; --black:#202124; --text:#202124; --text-muted:#5f6368;
      --border:#dadce0; --shadow:0 1px 2px 0 rgba(60,64,67,.3), 0 1px 3px 1px rgba(60,64,67,.15);
      --shadow-hover:0 1px 3px 0 rgba(60,64,67,.3), 0 4px 8px 3px rgba(60,64,67,.15);
      --radius:8px; --radius-lg:12px; --radius-xl:16px;
      --font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    }
    
    *{box-sizing:border-box; margin:0; padding:0}
    body{
      background:var(--gray); color:var(--text); font-family:var(--font-family);
      line-height:1.5; font-size:14px
    }

    /* ===== Sidebar Navigation ===== */
    .sidebar{
      position:fixed; top:0; left:0; width:280px; height:100vh;
      background:var(--white); border-right:1px solid var(--border);
      display:flex; flex-direction:column; z-index:1000; box-shadow:2px 0 8px rgba(0,0,0,0.1)
    }
    .sidebar-header{
      padding:24px; border-bottom:1px solid var(--border); text-align:center
    }
    .profile-section{
      display:flex; flex-direction:column; align-items:center; gap:12px
    }
    .profile-avatar{
      width:60px; height:60px; border-radius:50%; background:var(--primary);
      display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:24px
    }
    .profile-name{
      font-size:18px; font-weight:500; color:var(--text); margin:0
    }
    .profile-role{
      font-size:11px; font-weight:300; color:var(--text-muted); margin:0
    }
    .sidebar-nav{
      flex:1; padding:24px 0; overflow-y:auto
    }
    .nav-item{
      display:block; padding:12px 24px; text-decoration:none; font-weight:300;
      color:var(--text-muted); transition:all 0.2s; border-left:3px solid transparent;
      font-size:14px
    }
    .nav-item:hover{
      background:var(--gray-light); color:var(--text); border-left-color:var(--primary)
    }
    .nav-item.active{
      background:var(--primary-light); color:var(--primary); border-left-color:var(--primary);
      font-weight:500
    }
    .nav-item-icon{
      margin-right:12px; font-size:16px
    }
    
    /* ===== Section Separator ===== */
    .nav-separator{
      margin:16px 24px; border-top:1px solid var(--border); position:relative
    }
    .nav-separator-label{
      position:absolute; top:-10px; left:0; background:var(--white);
      padding:0 8px; font-size:11px; font-weight:600; color:var(--text-muted);
      text-transform:uppercase; letter-spacing:0.5px
    }
    
    /* ===== External Section Link ===== */
    .nav-item-external{
      display:block; padding:12px 24px; text-decoration:none; font-weight:500;
      color:var(--info); transition:all 0.2s; border-left:3px solid transparent;
      font-size:14px; background:linear-gradient(90deg, rgba(66, 133, 244, 0.05), transparent);
      border:1px solid rgba(66, 133, 244, 0.2); margin:8px 16px; border-radius:6px
    }
    .nav-item-external:hover{
      background:rgba(66, 133, 244, 0.1); color:var(--info);
      border-left-color:var(--info); border-color:var(--info);
      transform:translateX(2px)
    }
    .nav-item-external-icon{
      margin-right:8px; font-size:16px
    }
    .nav-item-external-arrow{
      float:right; font-size:12px; opacity:0.6
    }

    /* ===== Main Content ===== */
    .main-content{
      margin-left:280px; padding:24px 32px; min-height:100vh
    }

    /* ===== Page Header ===== */
    .page-header{
      display:flex; justify-content:space-between; align-items:center; margin-bottom:24px;
      padding-bottom:16px; border-bottom:1px solid var(--border)
    }
    .page-title{
      font-size:24px; font-weight:400; color:var(--text); margin:0
    }
    .page-subtitle{
      font-size:14px; color:var(--text-muted); margin:4px 0 0 0
    }
    .header-actions{
      display:flex; gap:12px; align-items:center
    }

    /* ===== Google Material Buttons ===== */
    .btn{
      padding:8px 16px; border-radius:4px; text-decoration:none; font-weight:500;
      transition:all 0.2s; border:none; cursor:pointer; display:inline-flex; align-items:center; gap:8px;
      font-size:14px; text-transform:none; box-shadow:0 1px 2px 0 rgba(60,64,67,.3), 0 1px 3px 1px rgba(60,64,67,.15)
    }
    .btn:hover{box-shadow:var(--shadow-hover)}
    .btn-primary{
      background:var(--primary); color:white
    }
    .btn-primary:hover{background:var(--primary-hover); color:white}
    .btn-secondary{
      background:var(--white); color:var(--text); border:1px solid var(--border)
    }
    .btn-secondary:hover{background:var(--gray-light); color:var(--text)}
    .btn-icon{
      padding:8px; border-radius:50%; background:var(--white); color:var(--text-muted);
      border:1px solid var(--border); box-shadow:var(--shadow)
    }
    .btn-icon:hover{background:var(--gray-light); color:var(--text)}
    .btn-sm{
      padding:4px 8px; font-size:10px; border-radius:4px
    }

    /* ===== Contest Table Styles ===== */
    .contest-row{
      cursor:pointer; transition:all 0.2s
    }
    .contest-row:hover{
      background:var(--gray-light)
    }
    .contest-row.active{
      background:linear-gradient(90deg, rgba(26, 115, 232, 0.1) 0%, transparent 100%);
      border-left:4px solid var(--success); position:relative
    }
    .contest-row.active::before{
      content:''; position:absolute; left:0; top:0; width:4px; height:100%;
      background:var(--success); animation:pulse-border 2s infinite
    }
    .contest-row.inactive{
      background:var(--gray-light); opacity:0.7; border-left:4px solid var(--gray-dark)
    }
    @keyframes pulse-border{
      0%, 100%{opacity:1}
      50%{opacity:0.5}
    }
    .contest-status-badge{
      display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:12px;
      font-size:11px; font-weight:700; text-transform:uppercase
    }
    .contest-status-badge.active{
      background:var(--success); color:white
    }
    .contest-status-badge.inactive{
      background:var(--gray-dark); color:white
    }
    .contest-actions{
      display:flex; gap:6px
    }
    .btn-action{
      padding:6px 12px; border-radius:6px; font-size:11px; font-weight:600; text-decoration:none;
      display:inline-flex; align-items:center; gap:4px; transition:all 0.2s; border:none; cursor:pointer
    }
    .btn-action-edit{
      background:var(--primary); color:white
    }
    .btn-action-edit:hover{
      background:var(--primary-hover); transform:translateY(-1px)
    }
    .btn-action-view{
      background:var(--gray-light); color:var(--text); border:1px solid var(--border)
    }
    .btn-action-view:hover{
      background:var(--gray); border-color:var(--primary)
    }
    .contest-details-row{
      background:var(--gray-light)
    }
    .contest-details-row td{
      padding:0; border-top:none; border-bottom:1px solid var(--border)
    }

    /* ===== Search and Filter Bar ===== */
    .search-filter-bar{
      background:var(--white); border-radius:var(--radius); padding:16px 20px;
      box-shadow:var(--shadow); border:1px solid var(--border); margin-bottom:20px;
      display:flex; gap:16px; align-items:center; flex-wrap:wrap
    }
    .search-box{
      flex:1; min-width:300px; position:relative
    }
    .search-input{
      width:100%; padding:12px 16px 12px 40px; border:1px solid var(--border);
      border-radius:24px; font-size:14px; background:var(--gray-light);
      transition:all 0.2s
    }
    .search-input:focus{
      outline:none; border-color:var(--primary); background:var(--white);
      box-shadow:0 0 0 2px var(--primary-light)
    }
    .search-icon{
      position:absolute; left:12px; top:50%; transform:translateY(-50%);
      color:var(--text-muted); font-size:16px
    }
    .filter-group{
      display:flex; flex-direction:column; gap:4px; min-width:120px
    }
    .filter-label{
      font-size:12px; font-weight:500; color:var(--text-muted); text-transform:uppercase
    }
    .filter-select{
      padding:8px 12px; border:1px solid var(--border); border-radius:4px;
      background:var(--white); font-size:14px; color:var(--text)
    }
    .filter-select:focus{
      outline:none; border-color:var(--primary); box-shadow:0 0 0 2px var(--primary-light)
    }

    /* ===== Data Table Container ===== */
    .table-container{
      background:var(--white); border-radius:var(--radius); box-shadow:var(--shadow);
      border:1px solid var(--border); overflow:hidden
    }
    .table-scroll-container{
      overflow-x:auto; max-width:100%
    }
    .table-header{
      padding:16px 20px; border-bottom:1px solid var(--border); background:var(--gray-light)
    }
    .table-title{
      font-size:16px; font-weight:500; color:var(--text); margin:0
    }
    .table-subtitle{
      font-size:12px; color:var(--text-muted); margin:4px 0 0 0
    }

    /* ===== Google Material Table ===== */
    .data-table{
      width:100%; border-collapse:collapse; font-size:13px
    }
    .data-table th{
      background:var(--gray-light); color:var(--text); font-weight:500; padding:12px 16px;
      text-align:left; border-bottom:1px solid var(--border); white-space:nowrap;
      font-size:12px; text-transform:uppercase; letter-spacing:0.5px
    }
    .data-table td{
      padding:12px 16px; border-bottom:1px solid var(--border); vertical-align:top;
      color:var(--text); font-size:13px
    }
    .data-table tr:hover{
      background:var(--gray-light)
    }
    .data-table tr:last-child td{
      border-bottom:none
    }

    /* ===== Table Cell Styles ===== */
    .cell-submission{
      font-family:'Roboto Mono', monospace; font-weight:500; color:var(--primary)
    }
    .cell-amount{
      font-weight:500; color:var(--text)
    }
    .cell-validity{
      display:inline-block; padding:4px 8px; border-radius:12px; font-size:11px;
      font-weight:600; text-transform:uppercase
    }
    .cell-validity.valid{
      background:var(--secondary-light); color:var(--secondary)
    }
    .cell-validity.invalid{
      background:#fce8e6; color:var(--danger)
    }
    .cell-reason{
      color:var(--text-muted); font-style:italic; max-width:150px;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap
    }
    .cell-store{
      font-weight:500; color:var(--text)
    }
    .cell-location{
      color:var(--text-muted); font-size:12px
    }
    .cell-name{
      font-weight:500; color:var(--text)
    }
    .cell-phone{
      font-family:'Roboto Mono', monospace; color:var(--text-muted)
    }
    .cell-email{
      color:var(--primary); text-decoration:none
    }
    .cell-email:hover{
      text-decoration:underline
    }
    .cell-address{
      color:var(--text-muted); font-size:12px; max-width:200px;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap
    }
    .cell-postcode{
      font-family:'Roboto Mono', monospace; color:var(--text-muted)
    }
    .cell-city{
      color:var(--text)
    }
    .cell-state{
      color:var(--text-muted); font-weight:500
    }
    .cell-receipt{
      color:var(--primary); text-decoration:none; font-weight:500
    }
    .cell-receipt:hover{
      text-decoration:underline
    }
    .cell-product{
      font-weight:500; color:var(--text); font-size:12px
    }
    .cell-qty{
      font-family:'Roboto Mono', monospace; color:var(--text-muted); font-size:12px
    }
    .cell-how-heard{
      color:var(--text-muted); font-size:11px; max-width:150px;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap
    }
    .cell-date{
      font-family:'Roboto Mono', monospace; color:var(--text-muted); font-size:11px
    }

    /* ===== Pagination ===== */
    .pagination{
      display:flex; justify-content:space-between; align-items:center;
      padding:16px 20px; border-top:1px solid var(--border); background:var(--white)
    }
    .pagination-info{
      font-size:12px; color:var(--text-muted)
    }
    .pagination-controls{
      display:flex; gap:8px; align-items:center
    }
    .page-btn{
      padding:8px 12px; border:1px solid var(--border); border-radius:4px;
      text-decoration:none; color:var(--text); background:var(--white);
      font-size:12px; transition:all 0.2s
    }
    .page-btn:hover{
      background:var(--gray-light); border-color:var(--primary)
    }
    .page-btn.current{
      background:var(--primary); color:white; border-color:var(--primary)
    }
    .page-btn:disabled{
      opacity:0.5; cursor:not-allowed; background:var(--gray-light)
    }

    /* ===== Empty State ===== */
    .empty-state{
      text-align:center; padding:60px 20px; color:var(--text-muted)
    }
    .empty-state-icon{
      font-size:48px; margin-bottom:16px; opacity:0.5
    }
    .empty-state-title{
      font-size:18px; font-weight:400; margin-bottom:8px; color:var(--text)
    }
    .empty-state-text{
      font-size:14px; color:var(--text-muted); margin-bottom:24px
    }

    /* ===== Responsive Design ===== */
    @media (max-width: 1024px){
      .main-content{margin-left:0; padding:16px}
      .sidebar{transform:translateX(-100%); transition:transform 0.3s ease}
      .sidebar.open{transform:translateX(0)}
      .search-filter-bar{flex-direction:column; align-items:stretch}
      .search-box{min-width:auto}
    }
    @media (max-width: 768px){
      .data-table{font-size:11px}
      .data-table th, .data-table td{padding:8px 12px}
      .pagination{flex-direction:column; gap:12px; align-items:stretch}
      .pagination-controls{justify-content:center}
    }
  </style>
</head>
<body>
  <!-- Side Navigation -->
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="profile-section">
        <div class="profile-avatar">K</div>
        <h3 class="profile-name">{{ request.user.username|title }}</h3>
        <p class="profile-role">Admin</p>
      </div>
    </div>
    
    <nav class="sidebar-nav">
      <!-- WhatsApp Contest Section -->
      <div class="nav-separator">
        <span class="nav-separator-label">WhatsApp Contest</span>
      </div>
      
      <a href="{% url 'dashboard' %}" class="nav-item">
        <span class="nav-item-icon">üìä</span>
        Dashboard
      </a>
      <a href="{% url 'contest_create' %}" class="nav-item">
        <span class="nav-item-icon">‚ûï</span>
        Contest Creation
      </a>
      <a href="{% url 'contest_manager' %}" class="nav-item active">
        <span class="nav-item-icon">üéØ</span>
        Contest Manager
      </a>
      <a href="{% url 'participants_manager' %}" class="nav-item">
        <span class="nav-item-icon">üë•</span>
        Participants Manager
      </a>
      <a href="{% url 'select_winners' %}" class="nav-item">
        <span class="nav-item-icon">üèÜ</span>
        Select Winners
      </a>
      
      <!-- Blasting Feature Section -->
      <div class="nav-separator">
        <span class="nav-separator-label">Blasting Feature</span>
      </div>
      
      <a href="{% url 'blast_groups_list' %}" class="nav-item">
        <span class="nav-item-icon">üìÅ</span>
        Customer Groups
      </a>
      <a href="{% url 'blast_create_campaign' %}" class="nav-item">
        <span class="nav-item-icon">‚úâÔ∏è</span>
        Create Blast
      </a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Page Header -->
    <div class="page-header">
      <div>
        <h1 class="page-title">{{ selected_contest.name }} - Contest Management</h1>
        <p class="page-subtitle">Detailed view of contest submissions and participant data</p>
        <div style="display: flex; gap: 16px; margin-top: 8px; font-size: 12px; color: var(--text-muted); align-items: center;">
          <span>üìÖ {{ selected_contest.starts_at|date:"M d, Y"|default:"N/A" }} - {{ selected_contest.ends_at|date:"M d, Y"|default:"N/A" }}</span>
          <span>üë• {{ total_entries }} total entries</span>
          <span>‚úÖ {{ selected_contest.verified_entries|default:"0" }} verified</span>
          <span style="color: var(--danger);">‚ö†Ô∏è {{ selected_contest.flagged_entries|default:"0" }} flagged</span>
          <span style="display: inline-flex; align-items: center; gap: 4px;">
            <span style="display:inline-block; width:8px; height:8px; background:{% if selected_contest.status == 'active' %}var(--success){% else %}var(--gray-dark){% endif %}; border-radius:50%;"></span>
            <strong style="text-transform: uppercase;">{{ selected_contest.status }}</strong>
          </span>
        </div>
      </div>
      <div class="header-actions">
        <a href="{% url 'contest_create' %}" class="btn btn-primary">
          ‚ûï Create New Contest
        </a>
        {% if selected_contest.id and selected_contest.id != 'merdeka_w1' and selected_contest.id != 'merdeka_w2' %}
        <a href="{% url 'contest_edit' selected_contest.id %}" class="btn btn-secondary">
          ‚úèÔ∏è Edit Contest
        </a>
        {% endif %}
        <button class="btn btn-icon" title="Export Data">üìä</button>
        <button class="btn btn-icon" title="Refresh">üîÑ</button>
        <a href="{% url 'contest_home' %}" class="btn btn-secondary">
          ‚Üê Back to Dashboard
        </a>
      </div>
    </div>

    <!-- Contest Navigation and Filter -->
    <div class="table-container" style="margin-bottom: 20px;">
      <div class="table-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <h3 class="table-title">Contest Navigation</h3>
          <p class="table-subtitle">Viewing contest {{ current_index|add:1 }} of {{ total_contests }}</p>
        </div>
        <div style="display: flex; gap: 12px; align-items: center;">
          <!-- Status Filter -->
          <select id="statusFilter" onchange="applyStatusFilter()" style="padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border); font-size: 14px;">
            <option value="">All Contests</option>
            <option value="active" {% if status_filter == 'active' %}selected{% endif %}>Active Only</option>
            <option value="inactive" {% if status_filter == 'inactive' %}selected{% endif %}>Inactive Only</option>
          </select>
          <!-- Navigation Buttons -->
          <div style="display: flex; gap: 8px;">
            {% if has_previous %}
            <a href="?contest={{ previous_contest_id }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="btn btn-secondary" style="padding: 8px 16px;">‚Üê Previous</a>
            {% else %}
            <button class="btn btn-secondary" disabled style="padding: 8px 16px; opacity: 0.5;">‚Üê Previous</button>
            {% endif %}
            {% if has_next %}
            <a href="?contest={{ next_contest_id }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="btn btn-secondary" style="padding: 8px 16px;">Next ‚Üí</a>
            {% else %}
            <button class="btn btn-secondary" disabled style="padding: 8px 16px; opacity: 0.5;">Next ‚Üí</button>
            {% endif %}
          </div>
        </div>
      </div>
      
      <!-- Contest Selector Dropdown -->
      <div style="padding: 12px; background: var(--gray-light); border-radius: var(--radius); margin-bottom: 16px;">
        <label for="contestSelector" style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 4px; display: block;">Select Contest:</label>
        <select id="contestSelector" onchange="switchContest()" style="width: 100%; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border); font-size: 14px;">
          {% for contest in contests %}
          <option value="{{ contest.id }}" {% if contest.id == selected_contest.id %}selected{% endif %}>
            {{ contest.name }} ({{ contest.status|upper }}) - {{ contest.total_entries }} entries
          </option>
          {% endfor %}
        </select>
      </div>
      
      <!-- Entries Table for Selected Contest -->
      <div class="table-scroll-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Submission No</th>
            <th>Full Name</th>
            <th>Phone Number</th>
            <th>Email</th>
            <th>Store</th>
            <th>Location</th>
            <th>Amount Spent</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
            {% for entry in entries %}
            <tr>
            <td><strong>{{ entry.submission_no|default:"N/A" }}</strong></td>
            <td>{{ entry.full_name|default:"N/A" }}</td>
            <td>{{ entry.phone_number|default:"N/A" }}</td>
            <td>{{ entry.email|default:"N/A" }}</td>
            <td>{{ entry.store|default:"N/A" }}</td>
            <td>{{ entry.store_location|default:"N/A" }}</td>
            <td><strong style="color: var(--primary);">RM{{ entry.amount_spent|default:"0.00" }}</strong></td>
            <td>
              {% if entry.validity == 'valid' %}
                <span class="status-badge active" style="background:var(--success); color:white;">VALID</span>
              {% elif entry.validity == 'invalid' %}
                <span class="status-badge ended" style="background:var(--danger); color:white;">INVALID</span>
              {% else %}
                <span class="status-badge ended" style="background:var(--gray-dark); color:white;">{{ entry.validity|upper|default:"PENDING" }}</span>
              {% endif %}
            </td>
            <td>
              <button class="btn btn-sm" onclick="viewEntryDetails('{{ entry.submission_no }}')" title="View details">üëÅÔ∏è</button>
            </td>
          </tr>
            {% empty %}
            <tr>
              <td colspan="9" style="text-align: center; padding: 40px; color: var(--text-muted);">
                No entries found for this contest.
              </td>
            </tr>
            {% endfor %}
        </tbody>
      </table>
      </div>
      
      <!-- Pagination -->
      {% if entries.has_other_pages %}
      <div style="display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 20px; padding: 16px;">
        {% if entries.has_previous %}
        <a href="?contest={{ selected_contest.id }}&page={{ entries.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="btn btn-secondary">‚Üê Previous</a>
        {% endif %}
        <span style="color: var(--text-muted); font-size: 14px;">
          Page {{ entries.number }} of {{ entries.paginator.num_pages }}
        </span>
        {% if entries.has_next %}
        <a href="?contest={{ selected_contest.id }}&page={{ entries.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="btn btn-secondary">Next ‚Üí</a>
        {% endif %}
      </div>
      {% endif %}
    </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                  <div>
                    <strong style="font-size: 12px; color: var(--text-muted); text-transform: uppercase;">Contest Information</strong>
                    <div style="margin-top: 8px; font-size: 14px;">
                      <div><strong>Description:</strong> {{ selected_contest.description|default:"No description provided" }}</div>
                      <div><strong>Requirements:</strong> 
                        {% if selected_contest.requires_nric %}NRIC required{% endif %}
                        {% if selected_contest.requires_receipt %}{% if selected_contest.requires_nric %}, {% endif %}Receipt required{% endif %}
                        {% if selected_contest.min_purchase_amount %}, Min RM{{ selected_contest.min_purchase_amount }}{% endif %}
                      </div>
                      <div><strong>Period:</strong> {{ selected_contest.starts_at|date:"M d, Y" }} - {{ selected_contest.ends_at|date:"M d, Y" }}</div>
                    </div>
                  </div>
                  <div>
                    <strong style="font-size: 12px; color: var(--text-muted); text-transform: uppercase;">Statistics</strong>
                    <div style="margin-top: 8px; font-size: 14px;">
                      <div><strong>Total Entries:</strong> 156</div>
                      <div><strong>Verified:</strong> 142 (91%)</div>
                      <div><strong>Flagged:</strong> 14 (9%)</div>
                    </div>
                  </div>
                  <div>
                    <strong style="font-size: 12px; color: var(--text-muted); text-transform: uppercase;">Download Options</strong>
                    <div style="margin-top: 8px; display: flex; flex-direction: column; gap: 8px;">
                      <button class="btn btn-primary btn-sm" onclick="downloadContestData('current', 'csv')">üìä Download CSV</button>
                      <button class="btn btn-secondary btn-sm" onclick="downloadContestData('current', 'xlsx')">üìà Download XLSX</button>
                      <button class="btn btn-secondary btn-sm" onclick="downloadContestData('current', 'pdf')">üìÑ Download PDF Report</button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>

          
        </tbody>
      </table>
    </div>

    <!-- Contest Selection and Search Bar -->
    <div class="search-filter-bar">
      <div class="filter-group" style="min-width: 200px;">
        <label class="filter-label">Select Contest</label>
        <select class="filter-select" onchange="handleContestChange(this.value)" id="contestSelector">
          {% for contest in contests %}
          <option value="{{ contest.id }}" {% if contest.id == selected_contest.id %}selected{% endif %}>
            {{ contest.name }} ({{ contest.status|title }})
          </option>
          {% endfor %}
        </select>
      </div>
      
      <div class="search-box" style="flex: 1; min-width: 300px;">
        <span class="search-icon">üîç</span>
        <input type="text" class="search-input" placeholder="Search entries by name, phone, email, or submission number..." 
               value="{{ search_query }}" onkeyup="handleSearch(this.value)" id="entrySearch">
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Status</label>
        <select class="filter-select" onchange="handleFilter('status', this.value)">
          <option value="">All Status</option>
          <option value="valid" {% if status_filter == 'valid' %}selected{% endif %}>Valid</option>
          <option value="invalid" {% if status_filter == 'invalid' %}selected{% endif %}>Invalid</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Store</label>
        <select class="filter-select" onchange="handleFilter('store', this.value)">
          <option value="">All Stores</option>
          <option value="ED FEST" {% if store_filter == 'ED FEST' %}selected{% endif %}>ED FEST</option>
          <option value="SK HARDWARE" {% if store_filter == 'SK HARDWARE' %}selected{% endif %}>SK HARDWARE</option>
          <option value="HARVEY NORMAN" {% if store_filter == 'HARVEY NORMAN' %}selected{% endif %}>HARVEY NORMAN</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Location</label>
        <select class="filter-select" onchange="handleFilter('location', this.value)">
          <option value="">All Locations</option>
          <option value="Selangor" {% if location_filter == 'Selangor' %}selected{% endif %}>Selangor</option>
          <option value="Sarawak" {% if location_filter == 'Sarawak' %}selected{% endif %}>Sarawak</option>
          <option value="Johor" {% if location_filter == 'Johor' %}selected{% endif %}>Johor</option>
        </select>
      </div>
    </div>

    <!-- Data Table -->
    <div class="table-container">
      <div class="table-header">
        <h3 class="table-title" id="entriesTitle">{{ selected_contest.name }} Entries ({{ total_entries }} total)</h3>
        <p class="table-subtitle">Click on any row to view detailed information</p>
      </div>
      
      {% if entries %}
      
      <!-- Current Contest Entries (Default) -->
      <div id="entries-current" class="contest-entries">
        <div class="table-scroll-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Submission No</th>
              <th>Amount Spent</th>
              <th>Validity</th>
              <th>Reason for Invalidity</th>
              <th>Product 1</th>
              <th>Qty 1</th>
              <th>Product 2</th>
              <th>Qty 2</th>
              <th>Product 3</th>
              <th>Qty 3</th>
              <th>Store</th>
              <th>Store Location</th>
              <th>Full Name</th>
              <th>Phone Number</th>
              <th>Email Address</th>
              <th>Address</th>
              <th>Postcode</th>
              <th>City</th>
              <th>State</th>
              <th>How Heard</th>
              <th>Submitted Date</th>
              <th>Receipt</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in entries %}
            <tr onclick="viewEntryDetails('{{ entry.submission_no }}')">
              <td class="cell-submission">{{ entry.submission_no }}</td>
              <td class="cell-amount">{{ entry.amount_spent }}</td>
              <td><span class="cell-validity {% if entry.validity == 'valid' %}valid{% elif entry.validity == 'duplicate' %}invalid{% else %}invalid{% endif %}">{{ entry.validity|upper }}</span></td>
              <td class="cell-reason">{{ entry.reason|default:"-" }}</td>
              <td class="cell-product">{{ entry.product_purchased_1|default:"-" }}</td>
              <td class="cell-qty">{{ entry.amount_purchased_1|default:"-" }}</td>
              <td class="cell-product">{{ entry.product_purchased_2|default:"-" }}</td>
              <td class="cell-qty">{{ entry.amount_purchased_2|default:"-" }}</td>
              <td class="cell-product">{{ entry.product_purchased_3|default:"-" }}</td>
              <td class="cell-qty">{{ entry.amount_purchased_3|default:"-" }}</td>
              <td class="cell-store">{{ entry.store }}</td>
              <td class="cell-location">{{ entry.store_location }}</td>
              <td class="cell-name">{{ entry.full_name }}</td>
              <td class="cell-phone">{{ entry.phone_number }}</td>
              <td><a href="mailto:{{ entry.email }}" class="cell-email">{{ entry.email }}</a></td>
              <td class="cell-address">{{ entry.address }}</td>
              <td class="cell-postcode">{{ entry.postcode }}</td>
              <td class="cell-city">{{ entry.city }}</td>
              <td class="cell-state">{{ entry.state }}</td>
              <td class="cell-how-heard">{{ entry.how_heard|default:"-" }}</td>
              <td class="cell-date">{{ entry.submitted_date|default:"-" }}</td>
              <td><a href="{{ entry.receipt_url }}" class="cell-receipt" onclick="event.stopPropagation()" target="_blank">View Receipt</a></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>


        <!-- Pagination -->
        <div class="pagination">
          <div class="pagination-info">
            Showing {{ entries.start_index }}-{{ entries.end_index }} of {{ total_entries }} entries
          </div>
          <div class="pagination-controls">
            {% if entries.has_previous %}
              <a href="?page={{ entries.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if store_filter %}&store={{ store_filter }}{% endif %}{% if location_filter %}&location={{ location_filter }}{% endif %}{% if contest_filter %}&contest={{ contest_filter }}{% endif %}" class="page-btn">Previous</a>
            {% else %}
              <span class="page-btn" disabled>Previous</span>
            {% endif %}
            
            {% for num in entries.paginator.page_range %}
              {% if entries.number == num %}
                <span class="page-btn current">{{ num }}</span>
              {% elif num > entries.number|add:'-3' and num < entries.number|add:'3' %}
                <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if store_filter %}&store={{ store_filter }}{% endif %}{% if location_filter %}&location={{ location_filter }}{% endif %}{% if contest_filter %}&contest={{ contest_filter }}{% endif %}" class="page-btn">{{ num }}</a>
              {% endif %}
            {% endfor %}
            
            {% if entries.has_next %}
              <a href="?page={{ entries.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if store_filter %}&store={{ store_filter }}{% endif %}{% if location_filter %}&location={{ location_filter }}{% endif %}{% if contest_filter %}&contest={{ contest_filter }}{% endif %}" class="page-btn">Next</a>
            {% else %}
              <span class="page-btn" disabled>Next</span>
            {% endif %}
          </div>
        </div>
      {% else %}
        <!-- Empty State -->
        <div class="empty-state">
          <div class="empty-state-icon">üìã</div>
          <h3 class="empty-state-title">No Contest Entries Found</h3>
          <p class="empty-state-text">
            No contest entries match your current search criteria. Try adjusting your filters or search terms.
          </p>
        </div>
      {% endif %}
    </div>
  </div>

  <script>
    // Contest change functionality
    function handleContestChange(contestId) {
      // Redirect to the contest manager with the selected contest
      window.location.href = `{% url 'contest_manager' %}?contest=${contestId}`;
    }
    
    // Switch contest from dropdown
    function switchContest() {
      const selector = document.getElementById('contestSelector');
      const contestId = selector.value;
      const statusFilter = document.getElementById('statusFilter').value;
      let url = `{% url 'contest_manager' %}?contest=${contestId}`;
      if (statusFilter) {
        url += `&status=${statusFilter}`;
      }
      window.location.href = url;
    }
    
    // Apply status filter
    function applyStatusFilter() {
      const statusFilter = document.getElementById('statusFilter').value;
      const contestId = '{{ selected_contest.id }}';
      let url = `{% url 'contest_manager' %}?contest=${contestId}`;
      if (statusFilter) {
        url += `&status=${statusFilter}`;
      }
      window.location.href = url;
    }

    // Search functionality with debouncing
    let searchTimeout;
    function handleSearch(query) {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        // Get current contest
        const contestSelector = document.getElementById('contestSelector');
        const currentContest = contestSelector ? contestSelector.value : 'current';
        
        // Filter entries in the current contest
        const currentEntries = document.getElementById(`entries-${currentContest}`);
        if (currentEntries) {
          const rows = currentEntries.querySelectorAll('tbody tr');
          rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            const matches = query.toLowerCase().split(' ').every(term => text.includes(term));
            row.style.display = matches ? '' : 'none';
          });
        }
      }, 300);
    }

    // Filter functionality
    function handleFilter(type, value) {
      const url = new URL(window.location);
      if (value) {
        url.searchParams.set(type, value);
      } else {
        url.searchParams.delete(type);
      }
      window.location.href = url.toString();
    }

    // View entry details
    function viewEntryDetails(submissionNo) {
      // This would typically open a modal or navigate to a detail page
      alert(`Viewing details for submission: ${submissionNo}`);
    }

    // Edit contest functionality
    function editContest() {
      // This would typically open a modal or navigate to edit page
      if (confirm('Edit contest settings? This will open the contest creation form with current values.')) {
        // In a real implementation, this would navigate to edit page or open modal
        window.location.href = '{% url "contest_create" %}?edit=true';
      }
    }

    // Toggle contest details
    function toggleContestDetails(contestId) {
      const detailsRow = document.getElementById(`contest-details-${contestId}`);
      if (detailsRow) {
        if (detailsRow.style.display === 'none') {
          // Close all other details rows
          document.querySelectorAll('.contest-details-row').forEach(row => {
            row.style.display = 'none';
          });
          // Show this details row
          detailsRow.style.display = 'table-row';
        } else {
          // Hide this details row
          detailsRow.style.display = 'none';
        }
      }
    }

    // Delete contest
    async function deleteContest(contestId, contestName) {
      if (!confirm(`Are you sure you want to delete "${contestName}"?\n\nThis action cannot be undone and will delete all entries associated with this contest.`)) {
        return;
      }

      try {
        const csrftoken = getCookie('csrftoken');
        const response = await fetch(`/contest/${contestId}/delete/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken || ''
          },
          credentials: 'same-origin'
        });

        const data = await response.json();
        
        if (response.ok && data.success) {
          // Remove the row from the table
          const row = document.querySelector(`tr[onclick*="${contestId}"]`);
          if (row) {
            row.style.transition = 'opacity 0.3s';
            row.style.opacity = '0';
            setTimeout(() => {
              row.remove();
              // Also remove details row if it exists
              const detailsRow = document.getElementById(`contest-details-${contestId}`);
              if (detailsRow) {
                detailsRow.remove();
              }
            }, 300);
          }
          
          // Show success message
          alert(`Contest "${contestName}" deleted successfully.`);
          
          // Reload page after a short delay to refresh the list
          setTimeout(() => {
            window.location.reload();
          }, 500);
        } else {
          alert(`Error deleting contest: ${data.error || 'Unknown error'}`);
        }
      } catch (error) {
        alert(`Error deleting contest: ${error.message}`);
      }
    }

    // Get CSRF token from cookies
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    // Download contest data
    function downloadContestData(contestId, format) {
      // Get contest name from the select element or current contest
      const contestSelector = document.getElementById('contestSelector');
      let contestName = 'Contest';
      
      if (contestId === 'current') {
        contestName = '{{ selected_contest.name|escapejs }}';
      } else if (contestSelector) {
        const option = contestSelector.querySelector(`option[value="${contestId}"]`);
        if (option) {
          contestName = option.textContent.split(' (')[0]; // Remove status part
        }
      }
      
      const fileName = `${contestName.replace(/\s+/g, '_')}_entries.${format}`;
      
      // Simulate download (in real implementation, this would be an actual download)
      alert(`Downloading ${contestName} data as ${format.toUpperCase()}...\n\nFile: ${fileName}\n\nIn a real implementation, this would:\n1. Generate the file with contest data\n2. Include all participant information\n3. Format according to the selected type\n4. Trigger browser download`);
      
      // In a real implementation, you might do something like:
      // window.location.href = `/api/contest/${contestId}/download?format=${format}`;
    }

    // Mobile sidebar toggle
    function toggleSidebar() {
      document.querySelector('.sidebar').classList.toggle('open');
    }

    // Add mobile menu button if needed
    if (window.innerWidth <= 1024) {
      const header = document.querySelector('.page-header');
      const menuBtn = document.createElement('button');
      menuBtn.innerHTML = '‚ò∞';
      menuBtn.className = 'btn btn-icon';
      menuBtn.style.marginRight = '12px';
      menuBtn.onclick = toggleSidebar;
      header.insertBefore(menuBtn, header.firstChild);
    }
  </script>
</body>
</html>