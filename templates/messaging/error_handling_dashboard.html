<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Error Handling Dashboard - WhatsApp Bulk Message</title>

  <style>
    :root{
      --primary:#1877f2; --primary-hover:#166fe5; --primary-light:#e7f3ff;
      --secondary:#42b883; --secondary-hover:#3aa876; --secondary-light:#e8f5e8;
      --success:#42b883; --warning:#f7b731; --danger:#e74c3c; --info:#17a2b8;
      --gray:#f0f2f5; --gray-dark:#65676b; --gray-light:#f8f9fa;
      --white:#ffffff; --black:#1c1e21; --text:#1c1e21;
      --border:#dadde1; --shadow:0 2px 4px rgba(0,0,0,0.1), 0 8px 16px rgba(0,0,0,0.1);
      --radius:8px; --radius-lg:12px;
    }
    *{box-sizing:border-box; margin:0; padding:0}
    body{background:var(--gray); color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; line-height:1.4; padding:24px}
    
    .dashboard-header{
      background:var(--white); border-radius:var(--radius-lg); padding:24px; margin-bottom:24px;
      box-shadow:var(--shadow); border:1px solid var(--border)
    }
    .dashboard-title{
      font-size:28px; font-weight:700; color:var(--text); margin-bottom:8px
    }
    .dashboard-subtitle{
      color:var(--gray-dark); font-size:14px
    }
    
    .status-grid{
      display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:20px; margin-bottom:24px
    }
    .status-card{
      background:var(--white); border-radius:var(--radius-lg); padding:20px; box-shadow:var(--shadow);
      border:1px solid var(--border); transition:all 0.2s
    }
    .status-card:hover{
      transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.15)
    }
    .status-card-header{
      display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;
      padding-bottom:12px; border-bottom:1px solid var(--border)
    }
    .status-card-title{
      font-size:18px; font-weight:600; color:var(--text); display:flex; align-items:center; gap:8px
    }
    .status-badge{
      padding:4px 12px; border-radius:12px; font-size:11px; font-weight:700; text-transform:uppercase
    }
    .status-badge.success{
      background:var(--success); color:white
    }
    .status-badge.error{
      background:var(--danger); color:white
    }
    .status-badge.warning{
      background:var(--warning); color:white
    }
    .status-badge.info{
      background:var(--info); color:white
    }
    .status-details{
      display:flex; flex-direction:column; gap:8px
    }
    .status-item{
      display:flex; justify-content:space-between; align-items:center; padding:8px 0
    }
    .status-label{
      font-size:13px; color:var(--gray-dark); font-weight:500
    }
    .status-value{
      font-size:13px; color:var(--text); font-weight:600
    }
    .status-error{
      background:#fef2f2; border-left:3px solid var(--danger); padding:12px; border-radius:6px;
      margin-top:12px; font-size:12px; color:var(--danger)
    }
    .back-btn{
      display:inline-flex; align-items:center; gap:8px; padding:10px 20px; background:var(--primary);
      color:white; text-decoration:none; border-radius:var(--radius); font-weight:600; margin-bottom:20px;
      transition:all 0.2s
    }
    .back-btn:hover{
      background:var(--primary-hover); transform:translateY(-1px)
    }
  </style>
</head>
<body>
  <a href="{% url 'contest_home' %}" class="back-btn">‚Üê Back to Dashboard</a>
  
  <div class="dashboard-header">
    <h1 class="dashboard-title">Error Handling & System Status</h1>
    <p class="dashboard-subtitle">Monitor system health, connections, and identify issues</p>
  </div>

  <div class="status-grid">
    <!-- WABot Connection Status -->
    <div class="status-card">
      <div class="status-card-header">
        <h3 class="status-card-title">
          üì± WABot Connection
        </h3>
        <span class="status-badge {% if wabot_status.connected %}success{% else %}error{% endif %}">
          {% if wabot_status.connected %}Connected{% else %}Disconnected{% endif %}
        </span>
      </div>
      <div class="status-details">
        <div class="status-item">
          <span class="status-label">Status:</span>
          <span class="status-value">{% if wabot_status.connected %}‚úÖ Connected{% else %}‚ùå Disconnected{% endif %}</span>
        </div>
        {% if wabot_status.instance_id %}
        <div class="status-item">
          <span class="status-label">Instance ID:</span>
          <span class="status-value">{{ wabot_status.instance_id }}</span>
        </div>
        {% endif %}
        {% if wabot_status.base_url %}
        <div class="status-item">
          <span class="status-label">Base URL:</span>
          <span class="status-value" style="font-size:11px; word-break:break-all">{{ wabot_status.base_url }}</span>
        </div>
        {% endif %}
        {% if wabot_status.error %}
        <div class="status-error">
          <strong>Error:</strong> {{ wabot_status.error }}
        </div>
        {% endif %}
      </div>
    </div>

    <!-- API Status -->
    <div class="status-card">
      <div class="status-card-header">
        <h3 class="status-card-title">
          üîë API & Security Keys
        </h3>
        <span class="status-badge {% if api_status.valid %}success{% else %}error{% endif %}">
          {% if api_status.valid %}Valid{% else %}Invalid{% endif %}
        </span>
      </div>
      <div class="status-details">
        <div class="status-item">
          <span class="status-label">API Key Status:</span>
          <span class="status-value">{% if api_status.valid %}‚úÖ Configured{% else %}‚ùå Missing{% endif %}</span>
        </div>
        {% if api_status.key_length %}
        <div class="status-item">
          <span class="status-label">Key Length:</span>
          <span class="status-value">{{ api_status.key_length }} characters</span>
        </div>
        {% endif %}
        {% if api_status.error %}
        <div class="status-error">
          <strong>Error:</strong> {{ api_status.error }}
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Web App Status -->
    <div class="status-card">
      <div class="status-card-header">
        <h3 class="status-card-title">
          üåê Web App Status
        </h3>
        <span class="status-badge {% if web_app_status.database == 'connected' %}success{% else %}error{% endif %}">
          {% if web_app_status.database == 'connected' %}Online{% else %}Offline{% endif %}
        </span>
      </div>
      <div class="status-details">
        <div class="status-item">
          <span class="status-label">Database:</span>
          <span class="status-value">{% if web_app_status.database == 'connected' %}‚úÖ Connected{% else %}‚ùå Error{% endif %}</span>
        </div>
        {% if web_app_status.errors %}
        {% for error in web_app_status.errors %}
        <div class="status-error">
          {{ error }}
        </div>
        {% endfor %}
        {% endif %}
      </div>
    </div>

    <!-- Account Status -->
    <div class="status-card">
      <div class="status-card-header">
        <h3 class="status-card-title">
          üë§ Account Status
        </h3>
        <span class="status-badge {% if account_status.issues|length == 0 %}success{% else %}warning{% endif %}">
          {% if account_status.issues|length == 0 %}Healthy{% else %}Issues{% endif %}
        </span>
      </div>
      <div class="status-details">
        <div class="status-item">
          <span class="status-label">Tenant:</span>
          <span class="status-value">{{ account_status.tenant|default:"N/A" }}</span>
        </div>
        <div class="status-item">
          <span class="status-label">Plan:</span>
          <span class="status-value">{{ account_status.plan|default:"N/A"|upper }}</span>
        </div>
        <div class="status-item">
          <span class="status-label">Status:</span>
          <span class="status-value">{% if account_status.active %}‚úÖ Active{% else %}‚ö†Ô∏è Inactive{% endif %}</span>
        </div>
        {% if account_status.issues %}
        {% for issue in account_status.issues %}
        <div class="status-error">
          {{ issue }}
        </div>
        {% endfor %}
        {% endif %}
      </div>
    </div>
  </div>

  <script>
    // Auto-refresh every 30 seconds
    setTimeout(function(){
      location.reload();
    }, 30000);
  </script>
</body>
</html>

